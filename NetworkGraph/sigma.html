<html>
<head>
  <style type="text/css">
  #sigmacontainer {
    max-width: 90%;
    height: 400px;
    margin: auto;
    background: blanchedalmond;
  }
  </style>
</head>
<body>
  <div id="sigmacontainer"></div>
  <script src="sigma.min.js"></script>
  <script src="worker.js"></script>
  <script src="supervisor.js"></script>
  <script>

  data1='[{"iotid":"12-ab-bb","iotname":"Prisechambre","parent":"12-ef-f5","r1":0,"r2":0,"r3":0,"r4":0,"lux":10,"hum":88,"temp":25,"current":0.5},{"iotid":"12-a5-5b","iotname":"Prisesalon","parent":"12-ef-f5","r1":1,"r2":0,"r3":1,"r4":0,"lux":105,"hum":56,"temp":20,"current":0},{"iotid":"12-ef-f5","iotname":"humexterieure","parent":0,"hum":56,"temp":20}]';

  data2='[  {    "iotid": "15-a5-b9",    "iotname": "Prise kitchen",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "14-a5-b9",    "iotname": "Prise sdb",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "13-a5-b9",    "iotname": "Prise mezzanine",    "parent": "12-a5-b9",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "12-a5-b9",    "iotname": "Prise cave",    "parent": "19-de-fa",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "12-ab-bb",    "iotname": "Prise chambre",    "parent": "12-ef-f5",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "12-a5-5b",    "iotname": "Prise salon",    "parent": "12-ef-f5",    "r1": 1,    "r2": 0,    "r3": 1,    "r4": 0,    "lux": 105,    "hum": 56,    "temp": 20,    "current": 0  },  {    "iotid": "12-ef-f5",    "iotname": "hum exterieure",    "parent": 0,    "hum": 56,    "temp": 20  },  {    "iotid": "72-cd-32",    "iotname": "hum interieur",    "parent": 0,    "hum": 48,    "temp": 19  },  {    "iotid": "19-de-fa",    "iotname": "store",    "parent": 0,    "r1": 0,    "s1": 0  }]';

  data3='[  {    "iotid": "15-a5-b0",    "iotname": "Prise kitchen0",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b1",    "iotname": "Prise kitchen1",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b2",    "iotname": "Prise kitchen2",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b3",    "iotname": "Prise kitchen3",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b4",    "iotname": "Prise kitchen4",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b5",    "iotname": "Prise kitchen5",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b6",    "iotname": "Prise kitchen",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "14-a5-b9",    "iotname": "Prise sdb",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "13-a5-b9",    "iotname": "Prise mezzanine",    "parent": "12-a5-b9",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "12-a5-b9",    "iotname": "Prise cave",    "parent": "19-de-fa",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "12-ab-bb",    "iotname": "Prise chambre",    "parent": "12-ef-f5",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "12-a5-5b",    "iotname": "Prise salon",    "parent": "12-ef-f5",    "r1": 1,    "r2": 0,    "r3": 1,    "r4": 0,    "lux": 105,    "hum": 56,    "temp": 20,    "current": 0  },  {    "iotid": "12-ef-f5",    "iotname": "hum exterieure",    "parent": 0,    "hum": 56,    "temp": 20  },  {    "iotid": "72-cd-32",    "iotname": "hum interieur",    "parent": 0,    "hum": 48,    "temp": 19  },  {    "iotid": "19-de-fa",    "iotname": "store",    "parent": 0,    "r1": 0,    "s1": 0  }]'

  data='[  {    "iotid": "15-f5-b0",    "iotname": "Prise depf",    "parent": "15-a5-b0",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-e5-b0",    "iotname": "Prise depe",    "parent": "15-a5-b0",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-d5-b0",    "iotname": "Prise depd",    "parent": "15-a5-b0",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-c5-b0",    "iotname": "Prise depc",    "parent": "15-a5-b0",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-b5-b0",    "iotname": "Prise depb",    "parent": "15-a5-b0",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b0",    "iotname": "Prise kitchen0",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b1",    "iotname": "Prise kitchen1",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b2",    "iotname": "Prise kitchen2",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b3",    "iotname": "Prise kitchen3",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b4",    "iotname": "Prise kitchen4",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b5",    "iotname": "Prise kitchen5",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "15-a5-b6",    "iotname": "Prise kitchen",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "14-a5-b9",    "iotname": "Prise sdb",    "parent": "72-cd-32",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "13-a5-b9",    "iotname": "Prise mezzanine",    "parent": "12-a5-b9",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "12-a5-b9",    "iotname": "Prise cave",    "parent": "19-de-fa",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "12-ab-bb",    "iotname": "Prise chambre",    "parent": "12-ef-f5",    "r1": 0,    "r2": 0,    "r3": 0,    "r4": 0,    "lux": 10,    "hum": 88,    "temp": 25,    "current": 0.5  },  {    "iotid": "12-a5-5b",    "iotname": "Prise salon",    "parent": "12-ef-f5",    "r1": 1,    "r2": 0,    "r3": 1,    "r4": 0,    "lux": 105,    "hum": 56,    "temp": 20,    "current": 0  },  {    "iotid": "12-ef-f5",    "iotname": "hum exterieure",    "parent": 0,    "hum": 56,    "temp": 20  },  {    "iotid": "72-cd-32",    "iotname": "hum interieur",    "parent": 0,    "hum": 48,    "temp": 19  },  {    "iotid": "19-de-fa",    "iotname": "store",    "parent": 0,    "r1": 0,    "s1": 0  }]'

  a=JSON.parse(data);

  var i,
  s,
  N = 100,
  E = 500,
  g = {
    nodes: [],
    edges: []
  };

  g.nodes.push({
    id: 'n0',
    label: 'Node 0',
    x: 0.5,
    y: 0.5,
    size: 3,
    color: 'red'
  });


  kl=1;
  ml=1;
  nl=1;
  nbparents=0;
  for(k=0;k<a.length;k++){
    if (a[k].parent==0){
      nbparents++;
    }
  }

  for(k=0;k<a.length;k++){

    if (a[k].parent==0){
          alpha1=(Math.PI*2/nbparents)*kl; //AmÃ©lioration : distance en fonction du signal recu

          g.nodes.push({
            id: 'n' + kl,
            label: a[k].iotname,
            x: Math.random(),
            y: Math.random(),
            size: Math.random(),
            color: '#666'
          });

          g.edges.push({
            id: 'e' + kl,
            source: 'n' + kl,
            target: 'n0',
            size: 0.8,
            color: '#ccc'
          });


          for(m=0;m<a.length;m++){

            if (a[m].parent==a[k].iotid){
              alpha2=Math.random()*Math.PI/3-Math.PI/6;

              g.nodes.push({
                id: 'n' + kl+ml,
                label: a[m].iotname,
                x: Math.random(),
                y: Math.random(),
                size: Math.random(),
                color: '#666'
              });

              g.edges.push({
                id: 'e' + kl+ml,
                source: 'n' + kl+ml,
                target: 'n'+kl,
                size: 0.8,
                color: '#ccc'
              });


              for(n=0;n<a.length;n++){

                if (a[n].parent==a[m].iotid){

                  g.nodes.push({
                    id: 'n' + kl+ml+nl,
                    label: a[m].iotname,
                    x: Math.random(),
                    y: Math.random(),
                    size: Math.random(),
                    color: '#666'
                  });

                  g.edges.push({
                    id: 'e' + kl+ml+nl,
                    source: 'n' + kl+ml+nl,
                    target: 'n'+kl+ml,
                    size: 0.8,
                    color: '#ccc'
                  });

                  nl++;

                };
              };

              ml++;
            };
          };

          kl++;

        };
      };



// Instantiate sigma:
s = new sigma({
  graph: g,
  container: 'sigmacontainer'
});

// Start the ForceAtlas2 algorithm when nex data is comming:
s.startForceAtlas2({worker: true, barnesHutOptimize: false,gravity :0.5 ,adjustSizes :false,edgeWeightInfluence :0,slowDown:100});

setTimeout(function () { //We stop ForceAtlas2 once the sigma graph is stabilized
    s.killForceAtlas2();
}, 8000); 

</script>
</body>
</html>